var V=Object.defineProperty,j=Object.defineProperties;var q=Object.getOwnPropertyDescriptors;var L=Object.getOwnPropertySymbols;var N=Object.prototype.hasOwnProperty,T=Object.prototype.propertyIsEnumerable;var v=(n,t,e)=>t in n?V(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e,g=(n,t)=>{for(var e in t||(t={}))N.call(t,e)&&v(n,e,t[e]);if(L)for(var e of L(t))T.call(t,e)&&v(n,e,t[e]);return n},x=(n,t)=>j(n,q(t));import{F as b,v as S,r as M,R as c,E as z,I as H,au as J,B as K,o as y}from"./antd.fa9dc31e.js";import{i as O}from"./index.49e89548.js";import{s as F}from"./styled-components.browser.esm.342f67f5.js";import{a as w}from"./index.4cbe69e4.js";import{m as P}from"./index.e517e542.js";import"./request.6e8ef974.js";const A=b.Item,I={labelCol:{span:4},wrapperCol:{span:12}},Q={wrapperCol:{span:8,offset:4}},U=F(S.Group)`
    padding-left: 23px;
    &>label{
        margin-right:20px;
        margin-top:5px
    }
`,W=F.div`
    flex:1;
    margin: 24px;
    &>div+div{
        margin-top:15px;
    }
`,X=function(n,t){let e=[];t.forEach(i=>{let o=n.find(_=>_._id===i);!o||e.push(o.name)});let m=e.length,s=n.length,u=m<s;return{checkedAll:m===s,checkList:e,indeterminate:u}},Y=(n=[],t=[])=>{let e=new Map;return t.filter(s=>n.includes(s._id)&&!s.pid).forEach(s=>{let u=t.filter(i=>i.pid===s._id),h=n.filter(i=>t.find(o=>i===o._id&&o.pid===s._id)),k=X(u,h);e.set(s._id,k)}),e},Z=({location:n,history:t,intl:e})=>{const{editData:m}=n.state||{},s=m!==void 0,[u]=b.useForm(),[h,k]=M.exports.useState([]),[i,o]=M.exports.useState();M.exports.useEffect(()=>{(async()=>{let r=await P.getAll();if(r.code)return y.error(r.msg);const l=Y(s?m.menuIds:[],r.data);o(l),k(r.data)})(),s&&u.setFieldsValue(m)},[]);const _=(a,r)=>({target:{checked:l}})=>{let p=l?{checkedAll:!0,checkList:r.map(d=>d.name),indeterminate:!1}:{checkedAll:!1,checkList:[],indeterminate:!1};l?i.set(a._id,p):i.delete(a._id),o(new Map(i))},B=(a,r)=>l=>{let p=l,d=p.length,f=r.length,E=d<f,C=d===f,R={checkedAll:C,checkList:p,indeterminate:E};!d&&E?i.delete(a._id):i.set(a._id,R),o(new Map(i))},D=a=>{let{checkedAll:r=!1,checkList:l=[],indeterminate:p=!1}=i.get(a._id)||{};const d=h.filter(f=>f.pid===a._id);return c.createElement("div",{key:a._id},c.createElement(S,{indeterminate:p,onChange:_(a,d),checked:r},a.name),c.createElement("div",null),c.createElement(U,{options:d.map(f=>f.name),value:l,onChange:B(a,d)}))},G=async a=>{let r=[];i.forEach(({checkList:p},d)=>{let f=p.map(E=>h.find(C=>C.name===E)._id);return r.push(d),r.push(...f)});let l=s?await w.edit(m._id,x(g({},a),{menuIds:r})):await w.add(x(g({},a),{menuIds:r}));if(l.code)return y.error(l.msg);y.success(l.msg),t.goBack()};return c.createElement(z,{className:"gx-card",title:e.formatMessage({id:"role.form"},{control:s?"Edit":"Create"})},c.createElement(b,x(g({},I),{form:u,name:"role",onFinish:G}),c.createElement(A,{label:e.formatMessage({id:"role.name"}),name:"name",rules:[{required:!0}]},c.createElement(H,null)),c.createElement(J,{orientation:"left"},e.formatMessage({id:"role.assign"})),c.createElement(W,g({},I),h.filter(a=>!a.pid).map(D)),c.createElement(A,g({},Q),c.createElement(K,{type:"primary",htmlType:"submit"},e.formatMessage({id:"buttons.submit"})))))};var ie=O(Z);export{ie as default};
//# sourceMappingURL=modify.bd7faa09.js.map
