{"version":3,"file":"index.32c9de0b.js","sources":["../../src/routes/visitor/index.jsx"],"sourcesContent":["import React, { useEffect, useState } from 'react';\r\nimport { useSelector } from 'react-redux';\r\nimport { Table, Card, Select } from 'antd';\r\nimport dayjs from 'dayjs';\r\n\r\nimport api from '../../api/visitor';\r\nimport adminApi from '../../api/admin';\r\n\r\nimport useListPage from '../../hook/useListPage';\r\nimport { buildFilter, buildTimeRangeFilter } from '../../components/Table/tableHelp';\r\nimport useSearchColumn from '../../hook/useSearchColumn';\r\nimport IntlMessages from \"../../util/IntlMessages\";\r\nimport { AddBtn, ModifyBtn, DangerBtn } from '../../components/styled/operateBtns';\r\n\r\nconst PermitStatus = {\r\n  2: 'Waiting', // 等待入場\r\n  5: 'In', //车辆已入场\r\n};\r\n\r\n/**@return {import('../../../components/tableHelp').buildDrodown} */\r\nconst buildAdminSelect =\r\n  defo =>\r\n    ({ selectedKeys, setSelectedKeys, confirm }) => {\r\n      return (\r\n        <Select\r\n          options={defo}\r\n          style={{ width: '100%' }}\r\n          value={selectedKeys}\r\n          onSelect={v => {\r\n            setSelectedKeys([v]);\r\n            confirm();\r\n          }}\r\n          placeholder='Click to select'\r\n        />\r\n      );\r\n    };\r\n\r\n/**@return {import('../../../components/tableHelp').buildDrodown} */\r\nconst buildStatusSelect =\r\n  () =>\r\n    ({ selectedKeys, setSelectedKeys, confirm }) => {\r\n      return (\r\n        <Select\r\n          options={[{ label: \"Waiting\", value: \"2\" }, { label: \"In\", value: \"5\" }]}\r\n          style={{ width: '100%' }}\r\n          value={selectedKeys}\r\n          onSelect={v => {\r\n            setSelectedKeys([v]);\r\n            confirm();\r\n          }}\r\n          placeholder='Click to select'\r\n        />\r\n      );\r\n    };\r\n\r\nconst Visitor = () => {\r\n  const { user } = useSelector(state => state.admin);\r\n  const { dataState, handleTableChange, deleOne, cachedParams } = useListPage(api);\r\n  const [adminOptions, setAdminOptions] = useState([]);\r\n  useEffect(() => {\r\n    adminApi\r\n      .getOptions()\r\n      .then(res => setAdminOptions(res))\r\n  }, [])\r\n\r\n  /**@type {import('antd/lib/table').ColumnsType} */\r\n  const columns = [\r\n    {\r\n      title: <IntlMessages id='table.operation' />,\r\n      dataIndex: 'sort',\r\n      key: 'operation',\r\n      render: (_, data) => {\r\n        return (\r\n          <div style={{ display: 'flex' }}>\r\n            <ModifyBtn carry={{ editData: data }} />\r\n            <DangerBtn onConfirm={deleOne(data._id)} />\r\n          </div>\r\n        );\r\n      },\r\n    },\r\n    {\r\n      title: <IntlMessages id='visitor.companyName' />,\r\n      dataIndex: 'companyName',\r\n      key: '~companyName',\r\n      filteredValue: cachedParams['~companyName'],\r\n      ...useSearchColumn('companyName'),\r\n    },\r\n    user ? (user.roleName === 'System Admin' || user.roleName.includes('Fleet')) ? {\r\n      title: <IntlMessages id='visitor.applicant' />,\r\n      dataIndex: 'applicant',\r\n      key: 'applicantId',\r\n      filteredValue: cachedParams.applicantId,\r\n      ...buildFilter(buildAdminSelect(adminOptions)),\r\n    } : {} : {},\r\n    // {\r\n    //   title: <IntlMessages id='visitor.approver' />,\r\n    //   dataIndex: 'approver',\r\n    //   key: 'approverId',\r\n    //   // render: v => <Tag>{v}</Tag>,\r\n    //   filteredValue: cachedParams.approverId,\r\n    //   ...buildFilter(buildAdminSelect(adminOptions)),\r\n    // },\r\n    {\r\n      title: <IntlMessages id='visitor.fullName' />,\r\n      dataIndex: 'fullName',\r\n      key: '~fullName',\r\n      filteredValue: cachedParams['~fullName'],\r\n      ...useSearchColumn('fullName'),\r\n    },\r\n    {\r\n      title: <IntlMessages id='visitor.contactPerson' />,\r\n      dataIndex: 'contactPerson',\r\n      key: '~contactPerson',\r\n      filteredValue: cachedParams['~contactPerson'],\r\n      ...useSearchColumn('contactPerson'),\r\n    },\r\n    {\r\n      title: <IntlMessages id='visitor.contactingDepartment' />,\r\n      dataIndex: 'deptName',\r\n      key: '~deptName'\r\n    },\r\n    {\r\n      title: <IntlMessages id='visitor.status' />,\r\n      dataIndex: 'permit',\r\n      key: 'status',\r\n      render: permit => PermitStatus[permit.status],\r\n      filteredValue: cachedParams['status'],\r\n      ...buildFilter(buildStatusSelect()),\r\n    },\r\n    {\r\n      title: <IntlMessages id='visitor.visitDate' />,\r\n      dataIndex: 'visitDate',\r\n      key: '#visitDate',\r\n      sorter: true,\r\n      sortOrder: cachedParams[\"sort\"]?.visitDate,\r\n      render: (visitDate) => dayjs(visitDate).format('YYYY-MM-DD'),\r\n      filteredValue: cachedParams['#visitDate'],\r\n      ...buildTimeRangeFilter(),\r\n    },\r\n    {\r\n      title: <IntlMessages id='visitor.timeEst' />,\r\n      dataIndex: 'timeEst',\r\n      key: '#visitDate',\r\n      render: t => t.map(v => dayjs(v).format('HH:mm')).join(' - '),\r\n    },\r\n    {\r\n      title: <IntlMessages id='visitor.carPlateNos' />,\r\n      dataIndex: 'carPlateNos',\r\n      render: v => v.map(m => m.licenceNumber).join(', '),\r\n    },\r\n    {\r\n      title: <IntlMessages id='visitor.email' />,\r\n      dataIndex: 'carPlateNos',\r\n      render: v => v.map(m => m.email).join(', '),\r\n    },\r\n  ];\r\n\r\n  return <Card title={<IntlMessages id='table.list' values={{ menu: 'Visitor' }} />}>\r\n    <AddBtn />\r\n    <Table\r\n      {...dataState}\r\n      className=\"gx-table-responsive\"\r\n      columns={columns}\r\n      rowKey='_id'\r\n      onChange={handleTableChange}\r\n    />\r\n  </Card>\r\n}\r\n\r\nexport default Visitor;"],"names":["PermitStatus","buildAdminSelect","defo","selectedKeys","setSelectedKeys","confirm","width","v","buildStatusSelect","label","value","Visitor","user","useSelector","state","admin","dataState","handleTableChange","deleOne","cachedParams","useListPage","api","adminOptions","setAdminOptions","useState","getOptions","then","res","columns","title","dataIndex","key","render","_","data","display","editData","_id","filteredValue","useSearchColumn","roleName","includes","applicantId","buildFilter","permit","status","sorter","sortOrder","visitDate","dayjs","format","buildTimeRangeFilter","t","map","join","m","licenceNumber","email","menu"],"mappings":"47BAcA,KAAMA,GAAe,GAChB,YACA,MAICC,EACJC,GACE,CAAC,CAAEC,eAAcC,kBAAiBC,6BAE7B,EAAD,CACE,QAASH,EACT,MAAO,CAAEI,MAAO,QAChB,MAAOH,EACP,SAAUI,GAAK,GACG,CAACA,SAGnB,YAAY,oBAMhBC,EACJ,IACE,CAAC,CAAEL,eAAcC,kBAAiBC,6BAE7B,EAAD,CACE,QAAS,CAAC,CAAEI,MAAO,UAAWC,MAAO,KAAO,CAAED,MAAO,KAAMC,MAAO,MAClE,MAAO,CAAEJ,MAAO,QAChB,MAAOH,EACP,SAAUI,GAAK,GACG,CAACA,SAGnB,YAAY,oBAKhBI,EAAU,IAAM,YACd,CAAEC,QAASC,EAAYC,GAASA,EAAMC,OACtC,CAAEC,YAAWC,oBAAmBC,UAASC,gBAAiBC,EAAYC,GACtE,CAACC,EAAcC,GAAmBC,mBAAS,wBACvC,IAAM,GAEXC,aACAC,KAAKC,GAAOJ,EAAgBI,KAC9B,SAGGC,GAAU,CACd,CACEC,sBAAQ,EAAD,CAAc,GAAG,oBACxBC,UAAW,OACXC,IAAK,YACLC,OAAQ,CAACC,EAAGC,oBAEP,MAAD,CAAK,MAAO,CAAEC,QAAS,yBACpB,EAAD,CAAW,MAAO,CAAEC,SAAUF,qBAC7B,EAAD,CAAW,UAAWhB,EAAQgB,EAAKG,SAK3C,GACER,sBAAQ,EAAD,CAAc,GAAG,wBACxBC,UAAW,cACXC,IAAK,eACLO,cAAenB,EAAa,iBACzBoB,EAAgB,gBAErB3B,EAAQA,EAAK4B,WAAa,gBAAkB5B,EAAK4B,SAASC,SAAS,SAAY,GAC7EZ,sBAAQ,EAAD,CAAc,GAAG,sBACxBC,UAAW,YACXC,IAAK,cACLO,cAAenB,EAAauB,aACzBC,EAAY1C,EAAiBqB,KAC9B,GAAK,MAUPO,sBAAQ,EAAD,CAAc,GAAG,qBACxBC,UAAW,WACXC,IAAK,YACLO,cAAenB,EAAa,cACzBoB,EAAgB,aAErB,GACEV,sBAAQ,EAAD,CAAc,GAAG,0BACxBC,UAAW,gBACXC,IAAK,iBACLO,cAAenB,EAAa,mBACzBoB,EAAgB,kBAErB,CACEV,sBAAQ,EAAD,CAAc,GAAG,iCACxBC,UAAW,WACXC,IAAK,aAEP,GACEF,sBAAQ,EAAD,CAAc,GAAG,mBACxBC,UAAW,SACXC,IAAK,SACLC,OAAQY,GAAU5C,EAAa4C,EAAOC,QACtCP,cAAenB,EAAa,QACzBwB,EAAYnC,MAEjB,GACEqB,sBAAQ,EAAD,CAAc,GAAG,sBACxBC,UAAW,YACXC,IAAK,aACLe,OAAQ,GACRC,UAAW5B,KAAa,OAAbA,cAAsB6B,UACjChB,OAASgB,GAAcC,EAAMD,GAAWE,OAAO,cAC/CZ,cAAenB,EAAa,eACzBgC,KAEL,CACEtB,sBAAQ,EAAD,CAAc,GAAG,oBACxBC,UAAW,UACXC,IAAK,aACLC,OAAQoB,GAAKA,EAAEC,IAAI9C,GAAK0C,EAAM1C,GAAG2C,OAAO,UAAUI,KAAK,QAEzD,CACEzB,sBAAQ,EAAD,CAAc,GAAG,wBACxBC,UAAW,cACXE,OAAQzB,GAAKA,EAAE8C,IAAIE,GAAKA,EAAEC,eAAeF,KAAK,OAEhD,CACEzB,sBAAQ,EAAD,CAAc,GAAG,kBACxBC,UAAW,cACXE,OAAQzB,GAAKA,EAAE8C,IAAIE,GAAKA,EAAEE,OAAOH,KAAK,+BAIlC,EAAD,CAAM,sBAAQ,EAAD,CAAc,GAAG,aAAa,OAAQ,CAAEI,KAAM,8BAC/D,EAAD,sBACC,EAAD,OACM1C,GADN,CAEE,UAAU,sBACV,UACA,OAAO,MACP,SAAUC"}