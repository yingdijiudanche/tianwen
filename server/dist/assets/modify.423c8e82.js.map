{"version":3,"file":"modify.423c8e82.js","sources":["../../src/routes/driver/modify.jsx"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\r\nimport dayjs from 'dayjs';\r\nimport { message, Form, Input, Button, Card, Select, DatePicker, Switch, Row, Col, Divider } from 'antd';\r\nimport { injectIntl } from \"react-intl\";\r\nimport {\r\n  PlusOutlined,\r\n  MinusCircleOutlined\r\n} from \"@ant-design/icons\";\r\n\r\nimport api from '../../api/driver';\r\nimport adminApi from '../../api/admin';\r\n\r\nconst Item = Form.Item;\r\nconst layout = {\r\n  labelCol: { span: 4 },\r\n  wrapperCol: { span: 12 },\r\n};\r\nconst tailLayout = {\r\n  wrapperCol: { span: 8, offset: 4 },\r\n};\r\nconst mr4 = { marginRight: \"4%\" };\r\nconst span20 = { span: 20 };\r\n\r\nconst Modify = ({ location, history, intl }) => {\r\n  const { editData } = location.state || {};\r\n  const [adminOptions, setAdminOptions] = useState([]);\r\n  const [classDisabled, setClassDisabled] = useState(false);\r\n  const isEdit = editData !== undefined;\r\n  const [form] = Form.useForm();\r\n\r\n  useEffect(() => {\r\n    if (isEdit) {\r\n      const data = {\r\n        ...editData,\r\n        authDate: dayjs(editData.authDate),\r\n        leaveRecord: editData.leaveRecord && editData.leaveRecord.map(item => {\r\n          return {\r\n            leaveDate: dayjs(item.leaveDate)\r\n          }\r\n        })\r\n      }\r\n      form.setFieldsValue(data);\r\n    }\r\n\r\n    adminApi\r\n      .getDriverOptions(isEdit ? editData.adminId : 'n')\r\n      .then(res => setAdminOptions(res));\r\n    //eslint-disable-next-line\r\n  }, []);\r\n\r\n  const onTypeChange = e => {\r\n    if (e !== 1 && e !== 2) {\r\n      setClassDisabled(true);\r\n      form.setFieldsValue({\r\n        class: false\r\n      });\r\n    } else {\r\n      setClassDisabled(false);\r\n    }\r\n  }\r\n\r\n  const onFinish = async values => {\r\n    let res = isEdit ? await api.edit(editData._id, values) : await api.add(values);\r\n    if (res.code) return message.error(res.msg);\r\n    message.success(res.msg);\r\n    history.goBack();\r\n  };\r\n\r\n  return <Card className=\"gx-card\" title={intl.formatMessage({ id: 'driver.form' }, { control: isEdit ? \"Edit\" : \"Create\" })}>\r\n    <Form {...layout} form={form} name='driver' onFinish={onFinish} autoComplete=\"off\">\r\n      <Item label={intl.formatMessage({ id: 'driver.nameEN' })} name='nameEN' rules={[{ required: true }]}>\r\n        <Input />\r\n      </Item>\r\n      <Item label={intl.formatMessage({ id: 'driver.nameCH' })} name='nameCH' rules={[{ required: true }]}>\r\n        <Input />\r\n      </Item>\r\n      <Item label={intl.formatMessage({ id: 'driver.email' })} name='email' rules={[{ required: true }]}>\r\n        <Input type=\"email\" />\r\n      </Item>\r\n      <Item label={intl.formatMessage({ id: 'driver.staffID' })} name='staffID'>\r\n        <Input />\r\n      </Item>\r\n      <Item label={intl.formatMessage({ id: 'driver.authDate' })} name='authDate' rules={[{ required: true }]}>\r\n        <DatePicker />\r\n      </Item>\r\n      <Item label={intl.formatMessage({ id: 'driver.type' })} name='type' rules={[{ required: true }]}>\r\n        <Select options={[{ label: 'Private Car', value: 1 }, { label: 'Light Goods Vehicle (Permitted gross vehicle weight not exceeding 5.5 tonnes)', value: 2 }, { label: 'Medium Goods Vehicle', value: 18 }, { label: 'Heavy Goods Vehicle', value: 19 }, { label: 'Special Purpose Vehicle', value: 21 }]} onChange={onTypeChange} />\r\n      </Item>\r\n      <Item label={intl.formatMessage({ id: 'driver.admin' })} name='adminId' rules={[{ required: true }]}>\r\n        <Select options={adminOptions} />\r\n      </Item>\r\n      <Item label={intl.formatMessage({ id: 'driver.automaticTransmission' })} name='class' valuePropName='checked' initialValue={false}>\r\n        <Switch checkedChildren='Yes' unCheckedChildren='No' disabled={classDisabled} />\r\n      </Item>\r\n      <Divider orientation=\"left\">{intl.formatMessage({ id: 'driver.leaveRecord' })}</Divider>\r\n      <Form.List name=\"leaveRecord\">\r\n        {(fields, { add, remove }) => {\r\n          return (\r\n            <Card>\r\n              {buildLeaveRecordItems(fields, add, remove)}\r\n            </Card>\r\n          );\r\n        }}\r\n      </Form.List>\r\n      <Item {...tailLayout}>\r\n        <Button type=\"primary\" htmlType=\"submit\">\r\n          {intl.formatMessage({ id: 'buttons.submit' })}\r\n        </Button>\r\n      </Item>\r\n    </Form>\r\n  </Card>\r\n}\r\n\r\n\r\nfunction buildLeaveRecordItems(fields, add, remove, key) {\r\n  return (\r\n    <Row key={key}>\r\n      {fields.map((field, i) => (\r\n        <Col span={4} style={mr4} key={field.key}>\r\n          <Row>\r\n            <Col span={span20.span}>\r\n              <Item\r\n                name={[field.name, \"leaveDate\"]}\r\n                fieldKey={[field.fieldKey, \"leaveDate\"]}\r\n                wrapperCol={span20}\r\n                rules={[{ required: true, message: \"Please input leave's.\", }]}\r\n              >\r\n                <DatePicker />\r\n              </Item>\r\n            </Col>\r\n            {i === 0 ? null : (<Col span={3}>\r\n              <Button danger type=\"text\" onClick={() => remove(field.name)}>\r\n                <MinusCircleOutlined />\r\n              </Button>\r\n            </Col>)}\r\n          </Row>\r\n        </Col>\r\n      ))}\r\n      <Col span={2}>\r\n        <Button block icon={<PlusOutlined />} onClick={() => add()} />\r\n      </Col>\r\n    </Row>\r\n  );\r\n}\r\n\r\nexport default injectIntl(Modify);"],"names":["Item","Form","layout","labelCol","span","wrapperCol","tailLayout","offset","mr4","marginRight","span20","Modify","location","history","intl","editData","state","adminOptions","setAdminOptions","useState","classDisabled","setClassDisabled","isEdit","undefined","form","useForm","data","authDate","dayjs","leaveRecord","map","item","leaveDate","setFieldsValue","getDriverOptions","adminId","then","res","onTypeChange","e","class","onFinish","values","api","edit","_id","add","code","message","error","msg","success","goBack","formatMessage","id","control","required","label","value","fields","remove","buildLeaveRecordItems","key","field","i","name","fieldKey","injectIntl"],"mappings":"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"}