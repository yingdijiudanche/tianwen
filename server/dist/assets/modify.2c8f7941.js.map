{"version":3,"file":"modify.2c8f7941.js","sources":["../../src/api/contractingBusinessDept/index.js","../../src/routes/visitor/modify.jsx"],"sourcesContent":["import req from \"../../util/request\";\r\n\r\nexport default {\r\n  getList: (params, cancelToken) =>\r\n    req.get(\"contractingBusinessDept/list\", { params, cancelToken }),\r\n  getOptions: (params) =>\r\n    req.get(\"contractingBusinessDept/options\", { params }),\r\n};\r\n","import React, { useState, useEffect } from \"react\";\r\nimport { message, Form, Input, Button, Select, Card, DatePicker, Divider, Row, Col, TimePicker } from 'antd';\r\nimport {\r\n  PlusOutlined,\r\n  MinusCircleOutlined\r\n} from \"@ant-design/icons\";\r\nimport { injectIntl } from \"react-intl\";\r\nimport dayjs from 'dayjs';\r\n\r\nimport api from '../../api/visitor';\r\nimport contractingBusinessDeptApi from '../../api/contractingBusinessDept';\r\n\r\nconst Item = Form.Item;\r\nconst layout = {\r\n  labelCol: { span: 4 },\r\n  wrapperCol: { span: 12 },\r\n};\r\nconst tailLayout = {\r\n  wrapperCol: { span: 8, offset: 4 },\r\n};\r\nconst mr4 = { marginRight: \"4%\" };\r\nconst span10 = { span: 10 };\r\nconst span24 = { span: 24 };\r\n\r\nconst Modify = ({ location, history, intl }) => {\r\n  const { editData } = location.state || {};\r\n  const [deptOptions, setDeptOptions] = useState([]);\r\n\r\n  const isEdit = editData !== undefined;\r\n  const [form] = Form.useForm();\r\n\r\n  useEffect(() => {\r\n    if (isEdit) {\r\n      const data = {\r\n        ...editData,\r\n        visitDate: dayjs(editData.visitDate),\r\n        timeEst: editData.timeEst.map(dayjs),\r\n      }\r\n      form.setFieldsValue(data);\r\n    }\r\n    contractingBusinessDeptApi\r\n      .getOptions()\r\n      .then(res => setDeptOptions(res))\r\n    //eslint-disable-next-line\r\n  }, []);\r\n\r\n  const onFinish = async values => {\r\n    let data = values;\r\n    let res = isEdit ? await api.edit(editData._id, data) : await api.add(data);\r\n    if (res.code) return message.error(res.msg);\r\n    message.success(res.msg);\r\n    history.goBack();\r\n  };\r\n\r\n  return <Card className=\"gx-card\" title={intl.formatMessage({ id: 'visitor.form' }, { control: isEdit ? \"Edit\" : \"Create\" })}>\r\n    <Form form={form}\r\n      {...layout}\r\n      name='visitor'\r\n      onFinish={onFinish}\r\n      autoComplete=\"off\"\r\n    >\r\n      <Item label={intl.formatMessage({ id: 'visitor.companyName' })} name='companyName' rules={[{ required: true }]}>\r\n        <Input />\r\n      </Item>\r\n      <Item label={intl.formatMessage({ id: 'visitor.fullName' })} name='fullName' rules={[{ required: true }]}>\r\n        <Input />\r\n      </Item>\r\n      <Item label={intl.formatMessage({ id: 'visitor.admissionNoticeEmail' })} name='admissionNoticeEmail' rules={[{ required: true }]}>\r\n        <Input type=\"email\" />\r\n      </Item>\r\n      <Item label={intl.formatMessage({ id: 'visitor.contactPerson' })} name='contactPerson' rules={[{ required: true }]}>\r\n        <Input />\r\n      </Item>\r\n      <Item label={intl.formatMessage({ id: 'visitor.contactingDepartment' })} name='contactingDepartmentId' rules={[{ required: true }]}>\r\n        <Select options={deptOptions} />\r\n      </Item>\r\n      <Item label={intl.formatMessage({ id: 'visitor.visitDate' })} name='visitDate' rules={[{ required: true }]}>\r\n        <DatePicker format=\"YYYY-MM-DD\" />\r\n      </Item>\r\n      <Item label={intl.formatMessage({ id: 'visitor.timeEst' })} name='timeEst' rules={[{ required: true }]}>\r\n        <TimePicker.RangePicker placeholder={[intl.formatMessage({ id: 'visitor.arrvialTime' }), intl.formatMessage({ id: 'visitor.departureTime' })]} />\r\n      </Item>\r\n      <Divider orientation=\"left\">{intl.formatMessage({ id: 'visitor.carPlateNos' })}</Divider>\r\n      <Form.List name=\"carPlateNos\" initialValue={[{ licenceNumber: '', email: '' }]}>\r\n        {(fields, { add, remove }) => {\r\n          return (\r\n            <Card>\r\n              {buildLicenceItems(fields, add, remove)}\r\n            </Card>\r\n          );\r\n        }}\r\n      </Form.List>\r\n      <Item {...tailLayout}>\r\n        <Button type=\"primary\" htmlType=\"submit\">\r\n          {intl.formatMessage({ id: 'buttons.submit' })}\r\n        </Button>\r\n      </Item>\r\n    </Form>\r\n  </Card>\r\n}\r\n\r\nfunction buildLicenceItems(fields, add, remove, key) {\r\n  return (\r\n    <Row key={key}>\r\n      {fields.map((field, i) => (\r\n        <Col span={10} style={mr4} key={field.key}>\r\n          <Row>\r\n            <Col span={span10.span}>\r\n              <Item\r\n                name={[field.name, \"licenceNumber\"]}\r\n                fieldKey={[field.fieldKey, \"licenceNumber\"]}\r\n                wrapperCol={span24}\r\n                rules={[{ required: true, message: \"Please input number's.\", }]}\r\n              >\r\n                <Input placeholder=\"licence number\" />\r\n              </Item>\r\n            </Col>\r\n            <Col span={span10.span}>\r\n              <Item\r\n                name={[field.name, \"email\"]}\r\n                fieldKey={[field.fieldKey, \"email\"]}\r\n                wrapperCol={span24}\r\n                rules={[{ required: true, message: \"Please input email's.\", }]}\r\n              >\r\n                <Input placeholder=\"email\" type=\"email\" />\r\n              </Item>\r\n            </Col>\r\n            {i === 0 ? null : (<Col span={4}>\r\n              <Button danger type=\"text\" onClick={() => remove(field.name)}>\r\n                <MinusCircleOutlined />\r\n              </Button>\r\n            </Col>)}\r\n          </Row>\r\n        </Col>\r\n      ))}\r\n      <Col span={2}>\r\n        <Button block icon={<PlusOutlined />} onClick={() => add()} />\r\n      </Col>\r\n    </Row>\r\n  );\r\n}\r\n\r\nexport default injectIntl(Modify);"],"names":["getList","params","cancelToken","req","get","getOptions","Item","Form","layout","labelCol","span","wrapperCol","tailLayout","offset","mr4","marginRight","span10","span24","Modify","location","history","intl","editData","state","deptOptions","setDeptOptions","useState","isEdit","undefined","form","useForm","data","visitDate","dayjs","timeEst","map","setFieldsValue","then","res","onFinish","values","api","edit","_id","add","code","message","error","msg","success","goBack","formatMessage","id","control","required","licenceNumber","email","fields","remove","buildLicenceItems","key","field","i","name","fieldKey","injectIntl"],"mappings":"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"}