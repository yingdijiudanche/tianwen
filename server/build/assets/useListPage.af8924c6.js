var L=Object.defineProperty,O=Object.defineProperties;var w=Object.getOwnPropertyDescriptors;var p=Object.getOwnPropertySymbols;var y=Object.prototype.hasOwnProperty,P=Object.prototype.propertyIsEnumerable;var C=(e,t,r)=>t in e?L(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,s=(e,t)=>{for(var r in t||(t={}))y.call(t,r)&&C(e,r,t[r]);if(p)for(var r of p(t))P.call(t,r)&&C(e,r,t[r]);return e},S=(e,t)=>O(e,w(t));var k=(e,t)=>{var r={};for(var n in e)y.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&p)for(var n of p(e))t.indexOf(n)<0&&P.call(e,n)&&(r[n]=e[n]);return r};import{r as g,o as h}from"./antd.fa9dc31e.js";import{u as z}from"./index.49e89548.js";import{a as D}from"./request.6e8ef974.js";const R=(e="")=>e.split("/")[1];function H(){const e=z(),t=g.exports.useRef();return g.exports.useEffect(()=>{const{pathname:r}=e.location;let n=sessionStorage.getItem(r);t.current=n?JSON.parse(n):null;const a=R(r),i=e.listen((c,f)=>{f==="PUSH"&&sessionStorage.setItem(r,JSON.stringify(t.current))});return()=>{i(),R(e.location.pathname)!==a&&sessionStorage.removeItem(r)}},[]),t}const T="canceled",J=e=>e===T;function M(e){const t=g.exports.useRef(null);return g.exports.useEffect(()=>()=>{t.current&&t.current.cancel(T)},[]),async(...n)=>(t.current===null?t.current=D.CancelToken.source():(t.current.cancel(),t.current=D.CancelToken.source()),e.call(e,t.current.token,J,...n))}const N=function(e={}){let i=e,{total:t,current:r,pageSize:n}=i,a=k(i,["total","current","pageSize"]);return a.page=r,a.limit=n,a},v=function(e=10){return{loading:!1,pagination:{current:1,pageSize:e,total:0},dataSource:[]}},A=function(e){let{pageSize:t,current:r,total:n,data:a}=e;return{loading:!1,pagination:{current:r,pageSize:t,total:n},dataSource:a}},U={staticParams:{},baseParams:{}};function G(e,{pageSize:t,staticParams:r,baseParams:n}=U){const[a,i]=g.exports.useState(()=>v(t)),c=H(),f=M(async(o,l,m)=>{i(d=>S(s({},d),{loading:!0}));let u=await e.getList(N(m),o);if(u.code){if(l(u.msg))return;h.error(u.msg);return}c.current=m,i(A(u))});g.exports.useEffect(()=>{let o=c.current?c.current:a.pagination;f(s(s(s({},n),o),r))},[]);const b=({current:o,pageSize:l},m,u)=>{let d=c.current||{},x=s(S(s({},d),{current:o===0?1:o,pageSize:l}),m);x.sort=u.order?{[u.field]:u.order}:void 0,f(s(s({},x),r))},E=o=>async()=>{let l=await e.dele(o);if(l.code)return h.error(l.msg);h.success(l.msg),a.dataSource.length===1&&(c.current.current=Math.max(c.current.current-1,1)),f(c.current)},I=()=>{f(c.current)};return{dataState:a,handleTableChange:b,deleOne:E,cachedParams:c.current||{},reload:I}}export{G as u};
//# sourceMappingURL=useListPage.af8924c6.js.map
