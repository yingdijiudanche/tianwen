var I=Object.defineProperty,L=Object.defineProperties;var O=Object.getOwnPropertyDescriptors;var m=Object.getOwnPropertySymbols;var C=Object.prototype.hasOwnProperty,y=Object.prototype.propertyIsEnumerable;var P=(e,t,r)=>t in e?I(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,c=(e,t)=>{for(var r in t||(t={}))C.call(t,r)&&P(e,r,t[r]);if(m)for(var r of m(t))y.call(t,r)&&P(e,r,t[r]);return e},S=(e,t)=>L(e,O(t));var k=(e,t)=>{var r={};for(var n in e)C.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&m)for(var n of m(e))t.indexOf(n)<0&&y.call(e,n)&&(r[n]=e[n]);return r};import{r as g,o as h}from"./antd.6184fff2.js";import{u as w}from"./index.7faa062c.js";import{a as D}from"./request.afec6a83.js";const R=(e="")=>e.split("/")[1];function z(){const e=w(),t=g.exports.useRef();return g.exports.useEffect(()=>{const{pathname:r}=e.location;let n=sessionStorage.getItem(r);t.current=n?JSON.parse(n):null;const a=R(r),i=e.listen((s,f)=>{f==="PUSH"&&sessionStorage.setItem(r,JSON.stringify(t.current))});return()=>{i(),R(e.location.pathname)!==a&&sessionStorage.removeItem(r)}},[]),t}const T="canceled",H=e=>e===T;function J(e){const t=g.exports.useRef(null);return g.exports.useEffect(()=>()=>{t.current&&t.current.cancel(T)},[]),async(...n)=>(t.current===null?t.current=D.CancelToken.source():(t.current.cancel(),t.current=D.CancelToken.source()),e.call(e,t.current.token,H,...n))}const M=function(e={}){let i=e,{total:t,current:r,pageSize:n}=i,a=k(i,["total","current","pageSize"]);return a.page=r,a.limit=n,a},N=function(e=10){return{loading:!1,pagination:{current:1,pageSize:e,total:0},dataSource:[]}},q=function(e){let{pageSize:t,current:r,total:n,data:a}=e;return{loading:!1,pagination:{current:r,pageSize:t,total:n},dataSource:a}},v={staticParams:{},baseParams:{}};function G(e,{pageSize:t,staticParams:r,baseParams:n}=v){const[a,i]=g.exports.useState(()=>N(t)),s=z(),f=J(async(o,l,d)=>{i(p=>S(c({},p),{loading:!0}));let u=await e.getList(M(d),o);if(u.code){if(l(u.msg))return;h.error(u.msg);return}s.current=d,i(q(u))});g.exports.useEffect(()=>{let o=s.current?s.current:a.pagination;f(c(c(c({},n),o),r))},[]);const b=({current:o,pageSize:l},d,u)=>{let p=s.current||{},x=c(S(c({},p),{current:o===0?1:o,pageSize:l}),d);x.sort=u.order?{[u.field]:u.order}:void 0,f(c(c({},x),r))},j=o=>async()=>{let l=await e.dele(o);if(l.code)return h.error(l.msg);h.success(l.msg),a.dataSource.length===1&&(s.current.current=Math.max(s.current.current-1,1)),f(s.current)},E=()=>{f(s.current)};return{dataState:a,handleTableChange:b,deleOne:j,cachedParams:s.current||{},reload:E}}export{G as u};
//# sourceMappingURL=useListPage.fe4e257c.js.map
